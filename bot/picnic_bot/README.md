# TelegramBot_PicnicAlicante

## Версия 6.0 от 20.09.2024

### 1. Описание проекта
Проект **TelegramBot_PicnicAlicante** предназначен для автоматического администрирования и организации ивентов. Пользователи взаимодействуют с ботом в Telegram, выбирая дату, время, количество участников, стиль мероприятия и другие параметры. В результате формируется заказ с возможностью расчета стоимости и бронирования.

### 2. Файловая структура проекта

- **`main.py`**: Основной файл проекта, запускающий бота и обрабатывающий пользовательские запросы.
- **`database_logger.py`**: Модуль, отвечающий за логирование операций с базой данных.
- **`abstract_functions.py`**: Набор вспомогательных функций для работы с базой данных и повторных попыток выполнения запросов.
- **`calculations.py`**: Модуль для выполнения расчетов стоимости на основе параметров заказа.
- **`calendar_reserve.py`**: Модуль для управления резервированием дат и работы с календарем.
- **`constants.py`**: Модуль, содержащий ключевые константы и временные данные, используемые в проекте.
- **`data_reserve.py`**: Модуль для управления зарезервированными данными и временем.
- **`keyboards.py`**: Модуль, создающий различные клавиатуры для взаимодействия с пользователем.
- **`message_handlers.py`**: Модуль, обрабатывающий сообщения и команды, отправляемые пользователями.
- **`order_info_sender.py`**: Модуль для отправки информации о заказах сервисной службе и администратору.
- **`media/`**: Директория с медиафайлами, включая видеоролики для приветствия.
  - **`IMG_4077_1 (online-video-cutter.com).mp4`**
  - **`IMG_5981 (online-video-cutter.com).mp4`**
  - **`IMG_6156 (online-video-cutter.com).mp4`**
  - **`IMG_6412 (online-video-cutter.com).mp4`**

### 3. Архитектура

#### 3.1 Принцип каскадности
В проекте используется принцип каскадности, который разделяет модули на **переменные** и **постоянные** абстракции:
- **Переменные абстракции** — это модули, которые учитывают предпочтения пользователей, позволяя выбирать различные опции (например, язык, дата, время).
- **Постоянные абстракции** — это модули, выполняющие однотипные задачи, такие как запросы подтверждения, приветствия или ввод имени, а также кнопки "Да" и "Нет".

На момент создания документации (09.09.2024) проект включает:
- Переменных абстракций: **9**
- Постоянных абстракций: **8**

#### 3.2 Перечень модулей и их функций

1. **`language_selection`** (переменный) — выбор языка.
   - Функция: `language_selection_keyboard()`

2. **`greeting`** (постоянный) — приветствие и запрос имени.
   - Функция: `handle_name()`

3. **`date_selection`** (переменный) — выбор даты мероприятия.
   - Функции: `generate_calendar_keyboard()`, `show_calendar()`

4. **`date_confirmation`** (постоянный) — подтверждение даты.
   - Функция: `disable_calendar_buttons()`

5. **`time_selection`** (переменный) — выбор времени мероприятия.
   - Функция: `generate_time_selection_keyboard()`

6. **`time_confirmation`** (постоянный) — подтверждение времени.
   - Функция: `disable_time_buttons()`

7. **`people_selection`** (переменный) — выбор количества участников.
   - Функция: `generate_person_selection_keyboard()`

8. **`people_confirmation`** (постоянный) — подтверждение количества участников.
   - Функция: `disable_person_buttons()`

9. **`style_selection`** (переменный) — выбор стиля мероприятия.
   - Функция: `generate_party_styles_keyboard()`

10. **`style_confirmation`** (постоянный) — подтверждение выбранного стиля.
    - Функция: `disable_style_buttons()`

11. **`preferences_request`** (переменный) — запрос предпочтений пользователя.
    - Функция: `handle_preferences()`

12. **`city_request`** (переменный) — запрос города для проведения мероприятия.
    - Функция: `handle_city()`

13. **`order_calculation`** (переменный) — формирование заказа и расчёт стоимости мероприятия.
    - Функция: `calculate_order_cost()`

14. **`bank_payment`** (переменный) — имитация процесса оплаты и переход к проформе.
    - Функция: `show_payment_page()`

15. **`confirmation_buttons`** (постоянный) — генерация кнопок "Да/Нет" для подтверждения действий.
    - Функция: `generate_confirmation_buttons()`

16. **`proforma_generator`** (переменный) — генерация проформы и возможность её сохранения.
    - Функции: `generate_proforma()`, `save_proforma()`

17. **`final_confirmation_buttons`** (постоянный) — генерация финальных кнопок для завершения или продолжения работы бота.
    - Функция: `generate_final_confirmation_buttons()`

### 4. Нововведения версии 5.0

#### 4.1 Новые модули

1. **`order_info_sender.py`** — отправка информации о заказе Сервисной службе и админу.
   - Назначение: отправка уведомлений о новом заказе.

2. **`calculations.py`** — расчёт стоимости заказа.
   - Назначение: расчёт общей стоимости мероприятия на основе введённых данных.

3. **`abstract_functions.py`** — вспомогательные функции для работы с базой данных.
   - Назначение: создание соединений с базой данных и повторные попытки при ошибках выполнения SQL-запросов.

4. **`proforma_generator.py`** — генерация и сохранение проформы.
   - Назначение: создание проформы на основе данных заказа с возможностью её сохранения.

### 5. Примечания

- В новой версии 5.0 добавлены модули для обработки платежей и создания проформ.
- Улучшена структура работы с языковыми предпочтениями пользователей, оптимизированы функции для взаимодействия с базой данных.
- Логирование и обработка ошибок улучшены для упрощения отладки и мониторинга работы бота.

### 6. Справочник функций

#### Функции для взаимодействия с пользователем:

1. **`language_selection_keyboard()`** — генерация клавиатуры для выбора языка.
2. **`handle_name()`** — обработка ввода имени пользователя.
3. **`generate_calendar_keyboard()`** — генерация клавиатуры для выбора даты мероприятия.
4. **`show_calendar()`** — отображение календаря для выбора даты.
5. **`disable_calendar_buttons()`** — деактивация кнопок календаря после выбора даты.
6. **`generate_time_selection_keyboard()`** — генерация клавиатуры для выбора времени мероприятия.
7. **`disable_time_buttons()`** — деактивация кнопок времени после выбора.
8. **`generate_person_selection_keyboard()`** — генерация клавиатуры для выбора количества участников.
9. **`disable_person_buttons()`** — деактивация кнопок выбора количества участников.
10. **`generate_party_styles_keyboard()`** — генерация клавиатуры для выбора стиля мероприятия.
11. **`disable_style_buttons()`** — деактивация кнопок стиля мероприятия.
12. **`handle_preferences()`** — обработка предпочтений пользователя.
13. **`handle_city()`** — обработка выбора города.
14. **`calculate_order_cost()`** — расчет стоимости мероприятия.
15. **`show_payment_page()`** — отображение страницы оплаты и переход к проформе.
16. **`generate_proforma()`** — генерация проформы на основе данных заказа.
17. **`save_proforma()`** — сохранение проформы.

#### Вспомогательные функции:

1. **`create_connection()`** — создание соединения с базой данных PostgreSQL.
2. **`execute_query()`** — выполнение SQL-запросов с логированием.
3. **`send_order_info_to_servis()`** — отправка информации о заказе Сервисной службе.
4. **`send_message_to_admin()`** — отправка информации о заказе админу.
5. **`get_translation()`** — получение перевода текста на основе предпочтений пользователя.
6. **`disable_yes_no_buttons()`** — деактивация кнопок "Да/Нет".
7. **`generate_confirmation_buttons()`** — генерация кнопок для подтверждения действий.

